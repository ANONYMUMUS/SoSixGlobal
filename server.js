const express = require('express');
const app = express();
const PORT = process.env.PORT || 3000;

// YOUR FULL PRECISION UI SCRIPT (BASE64 ENCODED)
const S = "bG9jYWwgVUlTID0gZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikKbG9jYWwgVHdlZW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJUd2VlblNlcnZpY2UiKQpsb2NhbCBIdHRwU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiSHR0cFNlcnZpY2UiKQpsb2NhbCBTb2NpYWxTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJTb2NpYWxTZXJ2aWNlIikKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgUGxheWVyR3VpID0gUGxheWVyOldhaXRGb3JDaGlsZCgiUGxheWVyR3VpIikKCi0tIFtbIENPTkZJR1VSQVRJT04gXV0KbG9jYWwgU0VSVkVSX1VSTCA9ICJodHRwczovL3Nvc2l4Z2xvYmFsLm9ucmVuZGVyLmNvbSIKbG9jYWwgbGFzdFRpbWVzdGFtcCA9IDAKbG9jYWwgY2FuU2VuZCA9IHRydWUKbG9jYWwgQ09PTERPV05fVElNRSA9IDMKbG9jYWwgTUFYX0NIQVJTID0gMzAwCgotLSBbWyAxLiBVSSBST09UIF1dCpsb2NhbCBTY3JlZW5HdWkgPSBJbnN0YW5jZS5uZXcoIlNjcmVlbkd1aSIsIFBsYXllckd1aSk7IFNjcmVlbkd1aS5OYW1lID0gIlNvbml4X1ByZWNpc2lvbl9GaW5hbCI7IFNjcmVlbkd1aS5SZXNldE9uU3Bhd24gPSBmYWxzZQoKLS0gW1sgMi4gQU5JTUFUSU9OIFBPU0lUSU9OUyBdXQpsb2NhbCBDaGF0VmlzaWJsZVBvcyA9IFVkaW0yLm5ldygwLjUsIC0xNjAsIDAuMSwgMCkgCmxvY2FsIENoYXRIaWRkZW5Qb3MgPSBVZGltMi5uZXcoMC41LCAtMTYwLCAwLjA1LCAwKSAKbG9jYWwgTWVudVZpc2libGVQb3MgPSBVZGltMi5uZXcoMC41LCAxNzAsIDAuMSwgMCkgCmxvY2FsIE1lbnVIaWRkZW5Qb3MgPSBVZGltMi5uZXcoMC41LCAxNDAsIDAuMSwgMCkgCgotLSBbWyAzLiBNQUlOIENPTlRBSU5FUiBdXQpsb2NhbCBNYWluQ29udGFpbmVyID0gSW5zdGFuY2UubmV3KCJDYW52YXNHcm91cCIsIFNjcmVlbkd1aSkKTWFpbkNvbnRhaW5lci5TaXplID0gVURpbTIubmV3KDAsIDMyMCwgMCwgMTgwKTsgTWFpbkNvbnRhaW5lci5Qb3NpdGlvbiA9IENoYXRIaWRkZW5Qb3MKTWFpbkNvbnRhaW5lci5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTIsIDEyLCAxMik7IE1haW5Db250YWluZXIuVmlzaWJsZSA9IGZhbHNlOyBNYWluQ29udGFpbmVyLkdyb3VwVHJhbnNwYXJlbmN5ID0gMQpJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIiwgTWFpbkNvbnRhaW5lcikuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMjApCgotLSBbWyA0LiBNRU5VIFNZU1RFTSBdXQpsb2NhbCBNZW51Q29udGFpbmVyID0gSW5zdGFuY2UubmV3KCJDYW52YXNHcm91cCIsIFNjcmVlbkd1aSkKTWVudUNvbnRhaW5lci5TaXplID0gVURpbTIubmV3KDAsIDEwMCwgMCwgMjIwKTsgTWVudUNvbnRhaW5lci5Qb3NpdGlvbiA9IE1lbnVIaWRkZW5Qb3MKTWVudUNvbnRhaW5lci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsgTWVudUNvbnRhaW5lci5Hcm91cFRyYW5zcGFyZW5jeSA9IDE7IE1lbnVDb250YWluZXIuVmlzaWJsZSA9IGZhbHNlCgpsb2NhbCBNZW51QnRuID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIiwgTWVudUNvbnRhaW5lcikKTWVudUJ0bi5TaXplID0gVURpbTIubmV3KDAsIDg1LCAwLCAzMCk7IE1lbnVCdG4uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwLCAyMCwgMjApOyBNZW51QnRuLlRleHQgPSAiIjsgTWVudUJ0bi5DbGlwc0Rlc2NlbmRhbnRzID0gdHJ1ZTsgTWVudUJ0bi5aSW5kZXggPSAxMApJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIiwgTWVudUJ0bikuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMTApCgpsb2NhbCBmdW5jdGlvbiBDcmVhdGVMaW5lKHkpCiAgICBsb2NhbCBsID0gSW5zdGFuY2UubmV3KCJGcmFtZSIsIE1lbnVCdG4pO2wuU2l6ZSA9IFVkaW0yLm5ldygwLCAxNiwgMCwgMik7bC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KQogICAgbC5Qb3NpdGlvbiA9IFVkaW0yLm5ldygwLCAyMCwgMCwgeSk7bC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMjU1LCAxNTApO2wuQm9yZGVyU2l6ZVBpeGVsID0gMDtsLlpJbmRleCA9IDExOyByZXR1cm4gbAplbmQKbG9jYWwgbDEsIGwyLCBsMyA9IENyZWF0ZUxpbmUoMTEpLCBDcmVhdGVMaW5lKDE1KSwgQ3JlYXRlTGluZSgxOSkKCmxvY2FsIE1lbnVMYWJlbCA9IEluc3RhbnNlLm5ldygiVGV4dExhYmVsIiwgTWVudUJ0bikKTWVudUxhYmVsLlNpemUgPSBVRGltMi5uZXcoMCwgNTAsIDEsIDApOyBNZW51TGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMzgsIDAsIDApOyBNZW51TGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7IE1lbnVMYWJlbC5UZXh0ID0gIk1FTlUiCk1lbnVMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMjU1LCAxNTApOyBNZW51TGFiZWwuVGV4dFNpemUgPSAxMDsgTWVudUxhYmVsLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZDsgTWVudUxhYmVsLlRleHRYQWxpZ25tZW50ID0gIkxlZnQiCgpsb2NhbCBzdWJCdXR0b25zID0ge30KbG9jYWwgYnRuTmFtZXMgPSB7IkNIQVQiLCAiRlJJRU5EUyIsICJQUk9GSUxFIiwgIklORk8ifQpmb3IgaSwgbmFtZSBpbiBpcGFpcnMoYnRuTmFtZXMpIGRvCiAgICBsb2NhbCBiID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIiwgTWVudUNvbnRhaW5lcikKICAgIGIuU2l6ZSA9IFVkaW0yLm5ldygwLCA4NSwgMCwgMzApOyBiLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAsIDApOyBiLkJhY2tncm91bmRDb2xvcmMgPSBDb2xvcmIzLmZyb21SR0IoMjAsIDIwLCAyMCkKICAgIGIuVGV4dENvbG9yMyA9IENvbG9yMy5uZXcoMSwgMSwgMSk7IGIuVGV4dCA9IG5hbWU7IGIuRm9udCA9IEVudW0uRm9udC5Hb3RoYW1Cb2xkOyBiLlRleHRTaXplID0gODsgYi5aSW5kZXggPSA1OyBiLlZpc2libGUgPSBmYWxzZTsgYi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsgYi5UZXh0VHJhbnNwYXJlbmN5ID0gMTsgSW5zdGFuY2UubmV3KCJVSUNvcm5lciIsIGIpLkNvcm5lclJhZGl1cyA9IFVkaW0ubmV3KDAsIDEwKQogICAgc3ViQnV0dG9uc1tpXSA9IGIKZW5kCgpsb2NhbCBtZW51T3BlbiA9IGZhbHNlCmxvY2FsIGZ1bmN0aW9uIFRvZ2dsZU1lbnUoc3RhdGUpCiAgICBtZW51T3BlbiA9IHN0YXRlCiAgICBpZiBtZW51T3BlbiB0aGVuCiAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShsMSwgVHdlZW5JbmZvLm5ldygwLjMpLCB7Um90YXRpb24gPSA0NSwgUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMjAsIDAsIDE1KX0pOlBsYXkoKQogICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUobDIsIFR3ZWVuSW5mby5uZXcoMC4yKSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCiAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShsMywgVHdlZW5JbmZvLm5ldygwLjMpLCB7Um90YXRpb24gPSAtNDUsIFBvc2l0aW9uID0gVURpbTIubmV3KDAsIDIwLCAwLCAxNSl9KTo0bGF5KCkKICAgICAgICBmb3IgaSwgYiBpbiBpcGFpcnMoc3ViQnV0dG9ucykgZG8KICAgICAgICAgICAgYi5WaXNpYmxlID0gdHJ1ZQogICAgICAgICAgICB0YXNrLmRlbGF5KGkgKiAwLjA4LCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKGIsIFR3ZWVuSW5mby5uZXcoMC40LCBFbnVtLkVhc2luZ1N0eWxlLkJhY2ssIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtQb3NpdGlvbiA9IFVkaW0yLm5ldygwLCAwLCAwLCAzNSArIChpLTEpKzM1KSwgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAsIFRleHRUcmFuc3BhcmVuY3kgPSAwfSk6UGxheSgpCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKGwxLCBUd2VlblJbmZvLm5ldygwLjMpLCB7Um90YXRpb24gPSAwLCBQb3NpdGlvbiA9IFVkaW0yLm5ldygwLCAyMCwgMCwgMTEpfSk6UGxheSgpCiAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShsMiwgVHdlZW5JbmZvLm5ldygwLjIpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KTo0bGF5KCkKICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKGwzLCBUd2VlblJbmZvLm5ldygwLjMpLCB7Um90YXRpb24gPSAwLCBQb3NpdGlvbiA9IFVkaW0yLm5ldygwLCAyMCwgMCwgMTkpfSk6UGxheSgpCiAgICAgICAgZm9yIF8sIGIgaW4gaXBhaXJzKHN1YkJ1dHRvbnMpIGRvCiAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoYiwgVHdlZW5JbmZvLm5ldygwLjI1KSwge1Bvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAsIDApLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwgVGV4dFRyYW5zcGFyZW5jeSA9IDF9KTo0bGF5KCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKTWVudUJ0bi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkgVG9nZ2xlTWVudShub3QgbWVudU9wZW4pIGVuZCkKCi0tIFtbIDUuIFBST0ZJTEUgU1lTVEVNIF1dCmxvY2FsIEluZm9MYXllciA9IEluc3RhbnNlLm5ldygiRnJhbWUiLCBTY3JlZW5HdWkpOyBJbmZvTGF5ZXIuU2l6ZSA9IE1haW5Db250YWluZXIuU2l6ZTsgSW5mb0xheWVyLlBvc2l0aW9uID0gQ2hhdFZpc2libGVQb3M7IEluZm9MYXllci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsgSW5mb0xheWVyLlZpc2libGUgPSBmYWxzZTsgSW5mb0xheWVyLlpJbmRleCA9IDk5OSAKbG9jYWwgQmx1ZmZPvmlscmxheSA9IEluc3RhbnNlLm5ldygiRnJhbWUiLCBJbmZvTGF5ZXIpOyBCbHVmZk92ZXJsYXkuU2l6ZSA9IFVkaW0yLm5ldygxLCAwLCAxLCAwKTsgQmx1ZmZPvmlscmxheS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygwLCAwLCAwKTsgQmx1ZmZPvmlscmxheS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsgQmx1ZmZPvmlscmxheS5aSW5kZXggPSAxOyBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIiwgQmx1ZmZPvmlscmxheSkuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMjApCgpsb2NhbCBBY3RpdmVCb3hlcyA9IHt9OyBsb2NhbCBDdXJyZW50SW5zcGVjdGluZyA9IG5pbDsgbG9jYWwgSXNBbmltYXRpbmcgPSBmYWxzZQpsb2NhbCBmdW5jdGlvbiBDbGVhckluZm8oKQogICAgQ3VycmVudEluc3BlY3RpbmcgPSBuaWwKICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoQmx1ZmZPvmlscmxheSwgVHdlZW5JbmZvLm5ldygwLjIpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KTo0bGF5KCkKICAgIGZvciBfLCBib3ggaW4gaXBhaXJzKEFjdGl2ZUJveGVzKSBkbyBib3g6RGVzdHJveSgpIGVuZAogICAgQWN0aXZlQm94ZXMgPSB7fQogICAgSW5mb0xheWVyLlZpc2libGUgPSBmYWxzZQogICAgSXNBbmltYXRpbmcgPSBmYWxzZQplbmQKbG9jYWwgZnVuY3Rpb24gQ3JlYXRlSW5mb0JveChsYWJlbCwgdmFsdWUsIHRhcmdldFBvcywgZGVsYXkpCiAgICB0YXNrLndhaXQoZGVsYXkpCiAgICBpZiBub3QgSW5mb0xheWVyLlZpc2libGUgdGhlbiByZXR1cm4gZW5kCiAgICBsb2NhbCBib3ggPSBJbnN0YW5jZS5uZXcoIlRleHRCdXR0b24iLCBJbmZvTGF5ZXIpOyBib3guU2l6ZSA9IFVkaW0yLm5ldygwLCA4NSwgMCwgMjgpOyBib3guUG9zaXRpb24gPSB0YXJnZXRQb3MgLSBVRGltMi5uZXcoMCwgMCwgMCwgMjApOyBib3guQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDQ1LCA0NSwgNDUpOyBib3guQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuMTsgYm94LlpJbmRleCA9IDEwOyBib3guVGV4dCA9ICIiOyBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIiwgYm94KS5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygxLCAwKQogICAgbG9jYWwgdHh0ID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiLCBib3gpOyB0eHQuU2l6ZSA9IFVkaW0yLm5ldygxLCAwLCAxLCAwKTsgdHh0LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOyB0eHQuUmljaFRleHQgPSB0cnVlOyB0eHQuVGV4dCA9ICI8Yj4iLi5sYWJlbC4uIjwvYj5cbiIuLnRvc3RyaW5nKHZhbHVlKTsgdHh0LlRleHRDb2xvcmIzID0gQ29sb3IzLm5ldygxLCAxLCAxKTsgdHh0LlRleHRTaXplID0gNzsgdHh0LlpJbmRleCA9IDExCiAgICBib3guTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpIHNldGNsaXBib2FyZCh0b3N0cmluZyh2YWx1ZSkpOyB0eHQuVGV4dCA9ICI8Yj5DT1BJRUQhPC9iPiI7IHRhc2sud2FpdCgwLjgpOyB0eHQuVGV4dCA9ICI8Yj4iLi5sYWJlbC4uIjwvYj5cbiIuLnRvc3RyaW5nKHZhbHVlKSBlbmQpCiAgICB0YWJsZS5pbnNlcnQoQWN0aXZlQm94ZXMsIGJveCkKICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoYm94LCBUd2VlblJbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuQmFjaywgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1Bvc2l0aW9uID0gdGFyZ2V0UG9zLCBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC4xfSk6UGxheSgpCmVuZApsb2NhbCBmdW5jdGlvbiBJbnNwZWN0KHVpZCwgbmFtZSkKICAgIGlmIElzQW5pbWF0aW5nIHRoZW4gcmV0dXJuIGVuZAogICAgaWYgQ3VycmVudEluc3BlY3RpbmcgPT0gdWlkIHRoZW4gQ2xlYXJJbmZvKCkgcmV0dXJuIGVuZAogICAgQ2xlYXJJbmZvKCkgCiAgICBJbmZvTGF5ZXIuVmlzaWJsZSA9IHRydWU7IElzQW5pbWF0aW5nID0gdHJ1ZTsgQ3VycmVudEluc3BlY3RpbmcgPSB1aWQKICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoQmx1ZmZPvmlscmxheSwgVHdlZW5JbmZvLm5ldygwLjMpLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuNn0pOnBsYXkoKQogICAgbG9jYWwgYWdlID0gMDsgcGNhbG9mdW5jdGlvbigpIGFnZSA9IChQbGF5ZXJzOkdldFBsYXllckJ5VXNlcklkKHVpZCkgb3Ige0FjY291bnRBZ2UgPSAwfSkuQWNjb3VudEFnZSBlbmQKICAgIGxvY2FsIG1pZFBmcCA9IEluc3RhbnNlLm5ldygiSW1hZ2VMYWJlbCIsIEluZm9MYXllcik7IG1pZFBmcC5TaXplID0gVURpbTIubmV3KDAsIDQwLCAwLCA0MCk7IG1pZFBmcC5Qb3NpdGlvbiA9IFVkaW0yLm5ldygwLjUsIC0yMCwgMC41LCAtMjApOyBtaWRQZnAuSW1hZ2UgPSBQbGF5ZXJzOkdldFVzZXJUaHVtYm5haWxBc3luYyh1aWQsIEVudW0uVGh1bWJuYWlsVHlwZS5IZWFkU2hvdCwgRW51bS5UaHVtYm5haWxTaXplLlNpemU0OHg0OCk7IG1pZFBmcC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsgbWlkUGZwLlpJbmRleCA9IDEwOyBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIiwgbWlkUGZwKS5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygxLCAwKQogICAgdGFibGUuaW5zZXJ0KEFjdGl2ZUJveGVzLCBtaWRQZnApCiAgICBsb2NhbCBBZGRCdG4gPSBJbnN0YW5jZS5uZXcoIlRleHRCdXR0b24iLCBJbmZvTGF5ZXIpCiAgICBBZGRCdG4uU2l6ZSA9IFVkaW0yLm5ldygwLCA4NSwgMCwgMjQpOyBBZGRCdG4uUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAtNDIsIDAuNSwgNDUpOyBBZGRCdG4uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDI1NSwgMTUwKTsgQWRkQnRuLlRleHQgPSAiQUREIEZSSUVORCI7IEFkZEJ0bi5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTIsIDEyLCAxMik7IEFkZEJ0bi5Gb250ID0gRW51bS5Gb250LkdvdGhhbUJvbGQ7IEFkZEJ0bi5UZXh0U2l6ZSA9IDg7IEFkZEJ0bi5aSW5kZXggPSAxNTsgQWRkQnRuLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOyBBZGRCdG4uVGV4dFRyYW5zcGFyZW5jeSA9IDEKICAgIEluc3RhbnNlLm5ldygiVUlD29ybmVyIiwgQWRkQnRuKS5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygxLCAwKTsgdGFibGUuaW5zZXJ0KEFjdGl2ZUJveGVzLCBBZGRCdG4pCiAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKEFkZEJ0biwgVHdlZW5JbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuQmFjaywgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLCBUZXh0VHJhbnNwYXJlbmN5ID0gMH0pOnBsYXkoKQogICAgQWRkQnRuLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIGlmIHVpZCA9PSBQbGF5ZXIuVXNlcklkIHRoZW4gQWRkQnRuLlRleHQgPSAiSVRTIFlPVSEiOyB0YXNrLndhaXQoMSk7IEFkZEJ0bi5UZXh0ID0gIkFERCBGUklFTkQiIGVsc2UKICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UGxheWVyID0gUGxheWVyczpHZXRQbGF5ZXJCeVVzZXJJZCh1aWQpCiAgICAgICAgICAgIGlmIHRhcmdldFBsYXllciB0aGVuIFNvY2lhbFNlcnZpY2U6UHJvbXB0U2VuZEZyaWVuZFJlcXVlc3QoUGxheWVyLCB0YXJnZXRQbGF5ZXIpIGVsc2UKICAgICAgICAgICAgICAgIHBjYWxvZnVuY3Rpb24oKSBQbGF5ZXI6U2V0RnJpZW5kUmVxdWVzdCh1aWQpIGVuZCk7IEFkZEJ0bi5UZXh0ID0gIlJFUVVFU1QgU0VOVCEiOyBBZGRCdG4uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDEwMCwgMTAwLCAxMDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpIENyZWF0ZUluZm9Cb3goIlVTRVJOQU1FIiwgbmFtZTpsb3dlcigpLCBVRGltMi5uZXcoMC41LCAtOTUsIDAuNSwgLTYwKSwgMCkgZW5kKQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpIENyZWF0ZUluZm9Cb3goIlVTRVJJRCIsIHVpZCwgVURpbTIubmV3KDAuNSwgMTAsIDAuNSwgLTYwKSwgMC4xKSBlbmQpCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkgQ3JlYXRlSW5mb0JveCgiU1RBVFVTIiwgIk9OTElORSIsIFVkaW0yLm5ldygwLjUsIC0xMDUsIDAuNSwgMTApLCAwLjIpIGVuZCkKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKSBDcmVhdGVJbmZvQm94KCJBR0UiLCBhZ2UgLi4gIiBEQVlTIiwgVURpbTIubmV3KDAuNSwgMjAsIDAuNSwgMTApLCAwLjMpIGVuZCkKICAgIHRhc2sud2FpdCgwLjYpOyBJc0FuaW1hdGluZyA9IGZhbHNlCmVuZAoKLS0gW1sgNi4gUyBCVVRUT04gJiBUT0dHTEUgQU5JTUFUSU9OIF1dCmxvY2FsIE1haW5CdG4gPSBJbnN0YW5jZS5uZXcoIlRleHRCdXR0b24iLCBTY3JlZW5HdWkpOyBNYWluQnRuLlNpemUgPSBVRGltMi5uZXcoMCwgMzUsIDAsIDMwKTsgTWFpbmJ0bi5Qb3NpdGlvbiA9IFVkaW0yLm5ldygwLjUsIC0yMDUsIDAuMSwgMCk7IE1haW5CdG4uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwLCAyMCwgMjApOyBNYWluQnRuLlRleHQgPSAiUyI7IE1haW5CdG4uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDI1NSwgMTUwKTsgTWFpbmJ0bi5Gb250ID0gRW51bS5Gb250LkdvdGhhbUJvbGQ7IE1haW5CdG4uVGV4dFNpemUgPSAxNDsgSW5zdGFuY2UubmV3KCJVSUNvcm5lciIsIE1haW5CdG4pLkNvcm5lclJhZGl1cyA9IFVkaW0ubmV3KDAsIDEwKQoKTWFpbmJ0bi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgIGlmIE1haW5Db250YWluZXIuVmlzaWJsZSB0aGVuCiAgICAgICAgQ2xlYXJJbmZvKCkKICAgICAgICBUb2dnbGVNZW51KGZhbHNlKQogICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoTWVudUNvbnRhaW5lciwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uSW4pLCB7UG9zaXRpb24gPSBNZW51SGlkZGVuUG9zLCBHcm91cFRyYW5zcGFyZW5jeSA9IDF9KTo0bGF5KCkKICAgICAgICB0YXNrLndhaXQoMC4xNSkKICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKE1haW5Db250YWluZXIsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLkluKSwge1Bvc2l0aW9uID0gQ2hhdEhpZGRlblBvcywgR3JvdXBUcmFuc3BhcmVuY3kgPSAxfSk6UGxheSgpCiAgICAgICAgdGFzay53YWl0KDAuMykKICAgICAgICBNYWluQ29udGFpbmVyLlZpc2libGUgPSBmYWxzZTsgTWVudUNvbnRhaW5lci5WaXNpYmxlID0gZmFsc2UKICAgIGVsc2UKICAgICAgICBNYWluQ29udGFpbmVyLlZpc2libGUgPSB0cnVlOyBNYWluQ29udGFpbmVyLkdyb3VwVHJhbnNwYXJlbmN5ID0gMTsgTWFpbmDb250YWluZXIuUG9zaXRpb24gPSBDaGF0SGlkZGVuUG9zCiAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShNYWluQ29udGFpbmVyLCBUd2VlblJbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuQmFjaywgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1Bvc2l0aW9uID0gQ2hhdFZpc2libGVQb3MsIEdyb3VwVHJhbnNwYXJlbmN5ID0gMH0pOnBsYXkoKQogICAgICAgIHRhc2sud2FpdCgwLjIpCiAgICAgICAgTWVudUNvbnRhaW5lci5WaXNpYmxlID0gdHJ1ZTsgTWVudUNvbnRhaW5lci5Hcm91cFRyYW5zcGFyZW5jeSA9IDE7IE1lbnVDb250YWluZXIuUG9zaXRpb24gPSBNZW51SGlkZGVuUG9zCiAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShNZW51Q29udGFpbmVyLCBUd2VlblJbmZvLm5ldygwLjQsIEVudW0uRWFzaW5nU3R5bGUuQmFjaywgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1Bvc2l0aW9uID0gTWVudVZpc2libGVQb3MsIEdyb3VwVHJhbnNwYXJlbmN5ID0gMH0pOnBsYXkoKQogICAgZW5kCmVuZCkKCi0tIFtbIDcuIENPUFkgQ09OVEVYVCBTWVNURU0gXV0KbG9jYWwgQ29udGV4dE92ZXJsYXkgPSBJbnN0YW5jZS5uZXcoIkZyYW1lIiwgU2NyZWVuR3VpKTsgQ29udGV4dE92ZXJsYXkuU2l6ZSA9IFVkaW0yLm5ldygxLDAsMSwwKTsgQ29udGV4dE92ZXJsYXkuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7IENvbnRleHRPdmVybGF5LlpJbmRleCA9IDIwMDA7IENvbnRleHRPdmVybGF5LlZpc2libGUgPSBmYWxzZQpsb2NhbCBCYWNrZHJvcCA9IEluc3RhbnNlLm5ldygiVGV4dEJ1dHRvbiIsIENvbnRleHRPdmVybGF5KTsgQmFja2Ryb3AuU2l6ZSA9IFVkaW0yLm5ldygxLCAwLCAxLCAwKTsgQmFja2Ryb3AuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuNjsgQmFja2Ryb3AuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5uZXcoMCwwLDApOyBCYWNrZHJvcC5UZXh0ID0gIiI7IEJhY2tkcm9wLkF1dG9CdXR0b25Db2xvciA9IGZhbHNlCkJhY2tkcm9wLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKSBDb250ZXh0T3ZlcmxheS5WaXNpYmxlID0gZmFsc2U7IGZvciBfLHYgaW4gcGFpcnMoQ29udGV4dE92ZXJsYXk6R2V0Q2hpbGRyZW4oKSkgZG8gaWYgdi5OYW1lID09ICJDb3B5QnRuIiB0aGVuIHY6RGVzdHJveSgpIGVuZCBlbmQgZW5kKQoKLS0gW1sgOC4gQ0hBVCAmIElOUFVUIF1dCpsb2NhbCBDaGF0Qm94ID0gSW5zdGFuY2UubmV3KCJTY3JvbGxpbmdGcmFtZSIsIE1haW5Db250YWluZXIpOyBDaGF0Qm94LlNpemUgPSBVRGltMi5uZXcoMSwgLTIwLCAxLCAtNjApOyBDaGF0Qm94LlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDEwLCAwLCAxMCk7IENoYXRCb3guQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7IENoYXRCb3guU2Nyb2xsQmFyVGhpY2tuZXNzID0gMDsgQ2hhdQm94LkF1dG9tYXRpY0NhbnZhc1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWTsgSW5zdGFuY2UubmV3KCJVSUxpc3RMYXlvdXQiLCBDaGF0Qm94KS5QYWRkaW5nID0gVURpbS5uZXcoMCwgNikKCmxvY2FsIGZ1bmN0aW9uIEFkZE1zZyh1aWQsIHVzZXIsIHRleHQpCiAgICBsb2NhbCBtc2dGcmFtZSA9IEluc3RhbnNlLm5ldygiRnJhbWUiLCBDaGF0Qm94KTsgbXNnRnJhbWUuU2l6ZSA9IFVkaW0yLm5ldygxLCAwLCAwLCAwKTsgbXNnRnJhbWUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7IG1zZ0ZyYW1lLkF1dG9tYXRpY1NpemUgPSAiWSIKICAgIGxvY2FsIHBmcCA9IEluc3RhbnNlLm5ldygiSW1hZ2VCdXR0b24iLCBtc2dGcmFtZSk7IHBmcC5TaXplID0gVURpbTIubmV3KDAsIDI2LCAwLCAyNik7IHBmcC5Qb3NpdGlvbiA9IFVkaW0yLm5ldygwLCAwLCAwLCAyKTsgcGZwLkltYWdlID0gUGxheWVyczpHZXRVc2VyVGh1bWJuYWlsQXN5bmModWlkLCBFbnVtLlRodW1ibmFpbFR5cGUuSGVhZFNob3QsIEVudW0uVGh1bWJuYWlsU2l6ZS5TaXplNDh4NDgpOyBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIiwgcGZwKS5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygxLCAwKTsgcGZwLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKSBJbnNwZWN0KHVpZCwgdXNlcikgZW5kKQogICAgCiAgICBsb2NhbCBjb250ZW50ID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiLCBtc2dGcmFtZSk7IGNvbnRlbnQuU2l6ZSA9IFVkaW0yLm5ldygxLCAtMzIsIDAsIDApOyBjb250ZW50LlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDMyLCAwLCAxMSk7IGNvbnRlbnQuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDE7IGNvbnRlbnQuVGV4dENvbG9yMyA9IENvbG9yMy5uZXcoMSwxLDEpOyBjb250ZW50LlRleHQgPSB0ZXh0OyBjb250ZW50LlRleHRTaXplID0gMTA7IGNvbnRlbnQuVGV4dFhBbGlnbm1lbnQgPSAiTGVmdCI7IGNvbnRlbnQuVGV4dFdyYXBwZWQgPSB0cnVlOyBjb250ZW50LkF1dG9tYXRpY1NpemUgPSAiWSIKICAgIGNvbnRlbnQuQWN0aXZlID0gdHJ1ZTsgY29udGVudC5TZWxlY3RhYmxlID0gdHJ1ZQoKICAgIGxvY2FsIGhlYWRlciA9IEluc3RhbnNlLm5ldygiVGV4dExhYmVsIiwgbXNnRnJhbWUpOyBoZWFkZXIuU2l6ZSA9IFVkaW0yLm5ldygxLCAtMzIsIDAsIDEwKTsgaGVhZGVyLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDMyLCAwLCAwKTsgaGVhZGVyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOyBoZWFkZXIuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE2MCwgMTYwLCAxNjApOyBoZWFkZXIuVGV4dCA9ICI8Yj4iIC4uIHVzZXI6bG93ZXIoKSAuLiAiPC9iPiI7IGhlYWRlci5UZXh0U2l6ZSA9IDc7IGhlYWRlci5SaWNoVGV4dCA9IHRydWU7IGhlYWRlci5UZXh0WEFsaWdubWVudCA9ICJMZWZ0IgoKICAgIGxvY2FsIGhvbGRUaW1lID0gMAogICAgY29udGVudC5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCiAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIG9yIGlucHV0LlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICBob2xkVGltZSA9IHRpY2soKQogICAgICAgICAgICBsb2NhbCBjdXJyZW50SG9sZCA9IGhvbGRUaW1lCiAgICAgICAgICAgIHRhc2suZGVsYXkoMC42LCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBob2xkVGltZSA9PSBjdXJyZW50SG9sZCBhbmQgKFVJUzpJc01vdXNlQnV0dG9uUHJlc3NlZChFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xKSBvciBVSVM6R2V0TW91c2VCdXR0b25zUHJlc3NlZCgpWzFdKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgQ29udGV4dE92ZXJsYXkuVmlzaWJsZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICBsb2NhbCBidG5BcmVhID0gSW5zdGFuY2UubmV3KCJGcmFtZSIsIENvbnRleHRPdmVybGF5KTsgYnRuQXJlYS5OYW1lID0gIkNvcHlCdG4iOyBidG5BcmVhLlNpemUgPSBVRGltMi5uZXcoMCwgNjAsIDAsIDI1KTsgYnRuQXJlYS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMTsgCiAgICAgICAgICAgICAgICAgICAgYnRuQXJlYS5Qb3NpdGlvbiA9IFVkaW0yLm5ldygwLCBjb250ZW50LkFic29sdXRlUG9zaXRpb24uWCArIDIwLCAwLCBjb250ZW50LkFic29sdXRlUG9zaXRpb24uWSArIDE1KQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGIgPSBJbnN0YW5jZS5uZXcoIlRleHRCdXR0b24iLCBidG5BcmVhKTsgYi5TaXplID0gVURpbTIubmV3KDEsIDAsIDEsIDApOyBiLkJhY2tncm91bmRDb2xvcmMgPSBDb2xvcmIzLmZyb21SR0IoNDUsIDQ1LCA0NSk7IGIuVGV4dCA9ICJDT1BZIjsgYi5UZXh0Q29sb3IzID0gQ29sb3IzLm5ldygxLDEsMSk7IGIuVGV4dFNpemUgPSAxMDsgSW5zdGFuY2UubmV3KCJVSUNvcm5lciIsIGIpCiAgICAgICAgICAgICAgICAgICAgYi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkgc2V0Y2xpYmJvYXJkKHRleHQpOyBDb250ZXh0T3ZlcmxheS5WaXNpYmxlID0gZmFsc2U7IGJ0bkFyZWE6RGVzdHJveSgpIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICBjb250ZW50LklucHV0RW5kZWQ6Q29ubmVjdChmdW5jdGlvbihpbnB1dCkgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIG9yIGlucHV0LlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbiBob2xkVGltZSA9IDAgZW5kIGVuZCkKICAgIHRhc2suZGVmZXIoZnVuY3Rpb24oKSBDaGF0Qm94LkNhbnZhc1Bvc2l0aW9uID0gVmVjdG9yMi5uZXcoMCwgQ2hhdQm94LkFic29sdXRlQ29udGVudFNpemUuWSkgZW5kKQplbmQKCi0tIFtbIDkuIElOUFVUIF1dCpsb2NhbCBJbnB1dEJhciA9IEluc3RhbnNlLm5ldygiRnJhbWUiLCBNYWluQ29udGFpbmVyKTsgSW5wdXRCYXIuU2l6ZSA9IFVkaW0yLm5ldygxLCAtMjAsIDAsIDMwKTsgSW5wdXRCYXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMTAsIDEsIC00MCk7IElucHV0QmFyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCmxvY2FsIElucHV0Qm94ID0gSW5zdGFuY2UubmV3KCJUZXh0Qm94IiwgSW5wdXRCYXIpOyBJbnB1dEJveC5TaXplID0gVURpbTIubmV3KDEsIC00MCwgMSwgMCk7IElucHV0Qm94LkJhY2tncm91bmRDb2xvcmMgPSBDb2xvcmIzLmZyb21SR0IoMjAsMjAsMjApOyBJbnB1dEJveC5UZXh0Q29sb3IzID0gQ29sb3IzLm5ldygxLDEsMSk7IElucHV0Qm94LlBsYWNlaG9sZGVyVGV4dCA9ICJNZXNzYWdlLi4uIjsgSW5wdXRCb3guVGV4dCA9ICIiOyBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIiwgSW5wdXRCb3gpOyBJbnN0YW5jZS5uZXcoIlVJUGFkZGluZyIsIElucHV0Qm94KS5QYWRkaW5nTGVmdCA9IFVkaW0ubmV3KDAsIDEwKQoKbG9jYWwgQ2hhckNvdW50ID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiLCBJbnB1dEJhcikKQ2hhckNvdW50LlNpemUgPSBVRGltMi5uZXcoMCwgMzUsIDAsIDEyKTsgQ2hhckNvdW50LlBvc2l0aW9uID0gVURpbTIubmV3KDEsIC0zNSwgMCwgLTEyKTsgQ2hhckNvdW50LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxOyBDaGFyQ291bnQuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDI1NSwgMTUwKTsgQ2hhckNvdW50LlRleHQgPSAiMC8zMDAiOyBDaGFyQ291bnQuVGV4dFNpemUgPSA4OyBDaGFyQ291bnQuRm9udCA9IEVudW0uRm9udC5Hb3RoYW1Cb2xkOyBDaGFyQ291bnQuVGV4dFhBbGlnbm1lbnQgPSAiQ2VudGVyIgoKbG9jYWwgU2VuZEJ0biA9IEluc3RhbnNlLm5ldygiVGV4dEJ1dHRvbiIsIElucHV0QmFyKTsgU2VuZEJ0bi5TaXplID0gVURpbTIubmV3KDAsIDM1LCAxLCAwKTsgU2VuZEJ0bi5Qb3NpdGlvbiA9IFVkaW0yLm5ldygxLC0zNSwwLDApOyBTZW5kQnRuLkJhY2tncm91bmRDb2xvcmMgPSBDb2xvcmIzLmZyb21SR0IoMzAsMzAsMzApOyBTZW5kQnRuLlRleHQgPSAiwrsiOyBTZW5kQnRuLlRleHRDb2xvcmIzID0gQ29sb3IzLmZyb21SR0IoMCwgMjU1LCAxNTApOyBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIiwgU2VuZEJ0bikKCklucHV0Qm94OkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgiVGV4dCIpOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgbG9jYWwgbGVuZ3RoID0gI0lucHV0Qm94LlRleHQKICAgIGlmIGxlbmd0aCA+IE1BWF9DSEFSUyB0aGVuIElucHV0Qm94LlRleHQgPSBzdHJpbmcuc3ViKElucHV0Qm94LlRleHQsIDEsIE1BWF9DSEFSUyk7IGxlbmd0aCA9IE1BWF9DSEFSUyBlbmQKICAgIENoYXJDb3VudC5UZXh0ID0gbGVuZ3RoIC4uICIvIiAuLiBNQVhfQ0hBUlM7IENoYXJDb3VudC5UZXh0Q29sb3IzID0gKGxlbmd0aCA+PSBNQVhfQ0hBUlMpIGFuZCBDb2xvcmIzLmZyb21SR0IoMjU1LCAwLCAwKSBvciBDb2xvcmIzLmZyb21SR0IoMCwgMjU1LCAxNTApCmVuZCkKCmxvY2FsIGZ1bmN0aW9uIFNlbmQodHh0KQogICAgaWYgbm90IGNhblNlbmQgb3IgdHh0ID09ICIiIHRoZW4gcmV0dXJuIGVuZAogICAgY2FuU2VuZCA9IGZhbHNlOyBTZW5kQnRuLlRleHRDb2xvcmIzID0gQ29sb3IzLmZyb21SR0IoODAsIDgwLCA4MCkKICAgIAogICAgbG9jYWwgcGF5bG9hZCA9IEh0dHBTZXJ2aWNlOkpTT05FbmNvZGUoewogICAgICAgIFBsYXllck5hbWUgPSBQbGF5ZXIuTmFtZSwKICAgICAgICBVc2VySWQgPSBQbGF5ZXIuVXNlcklkLAogICAgICAgIE1lc3NhZ2UgPSB0eHQKICAgIH0pCgogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgc3VjY2VzcywgZXJyID0gcGNhbG9mdW5jdGlvbigpCiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0KHsKICAgICAgICAgICAgICAgIFVybCA9IFNFUlZFU19VUkwgLi4gIi9zZW5kIiwKICAgICAgICAgICAgICAgIE1ldGhvZCA9ICJQT1NUIiwKICAgICAgICAgICAgICAgIEhlYWRlcnMgPSB7WyJDb250ZW50LVR5cGUiXSA9ICJhcHBsaWNhdGlvbi9qc29uIn0sCiAgICAgICAgICAgICAgICBCb2R5ID0gcGF5bG9hZAogICAgICAgICAgICB9KQogICAgICAgIGVuZCkKICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuIHdhcm4oIlNvbml4IFNlbmQgRXJyb3I6ICIgLi4gdG9zdHJpbmcoZXJyKSkgZW5kCiAgICBlbmQpCiAgICAKICAgIHRhc2suZGVsYXkoQ09PTERPV05fVElNRSwgZnVuY3Rpb24oKSBjYW5TZW5kID0gdHJ1ZTsgU2VuZEJ0bi5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMjU1LCAxNTApIGVuZCkKZW5kCgpTZW5kQnRuLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKSBpZiBjYW5TZW5kIGFuZCBJbnB1dEJveC5UZXh0IH49ICIiIHRoZW4gbG9jYWwgdCA9IElucHV0Qm94LlRleHQ7IElucHV0Qm94LlRleHQgPSAiIjsgSW5wdXRCb3g6UmVsZWFzZUZvY3VzKCk7IFNlbmQodCkgZW5kIGVuZCkKCi0tIFtbIDEwLiBSRUNPREVEIFJFTkRFUiBTWU5DIExPT1AgXV0Kc3ViQnV0dG9uc1szXS5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkgSW5zcGVjdChQbGF5ZXIuVXNlcklkLCBQbGF5ZXIuTmFtZSkgZW5kKQoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICBwcmludCgiU29uaXggUHJlY2lzaW9uOiBTeW5jIExvb3AgU3RhcnRlZCIpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgbG9jYWwgc3VjY2VzcywgcmVzcG9uc2UgPSBwY2Fsb2Z1bmN0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3QoewogICAgICAgICAgICAgICAgVXJsID0gU0VSVkVSX1VSTCAuLiAiL2dldF9tZXNzYWdlcz9hZnRlcj0iIC4uIHRvc3RyaW5nKGxhc3RUaW1lc3RhbXApLAogICAgICAgICAgICAgICAgTWV0aG9kID0gIkdFVCIKICAgICAgICAgICAgfSkKICAgICAgICBlbmQpCgogICAgICAgIGlmIHN1Y2Nlc3MgYW5kIHJlc3BvbnNlLlN0YXR1c0NvZGUgPT0gMjAwIHRoZW4KICAgICAgICAgICAgbG9jYWwgbWVzc2FnZXMgPSBIdHRwU2VydmljZTpKU09ORGVjb2RlKHJlc3BvbnNlLkJvZHkpCiAgICAgICAgICAgIHRhYmxlLnNvcnQobWVzc2FnZXMsIGZ1bmN0aW9uKGEsIGIpIHJldHVybiBhLlRpbWVzdGFtcCA8IGIuVGltZXN0YW1wIGVuZCkKCiAgICAgICAgICAgIGZvciBfLCBtIGluIGlwYWlycyhtZXNzYWdlcykgZG8KICAgICAgICAgICAgICAgIGlmIG0uVGltZXN0YW1wID4gbGFzdFRpbWVzdGFtcCB0aGVuCiAgICAgICAgICAgICAgICAgICAgQWRkTXNnKG0uVXNlcklkIG9yIDEsIG0uUGxheWVyTmFtZSBvciAiVW5rbm93biIsIG0uTWVzc2FnZSBvciAiIikKICAgICAgICAgICAgICAgICAgICBsYXN0VGltZXN0YW1wID0gbS5UaW1lc3RhbXAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgc3VjY2VzcyBhbmQgcmVzcG9uc2UuU3RhdHVzQ29kZSA9PSA1MDMgdGhlbgogICAgICAgICAgICBwcmludCgiU29uaXg6IFNlcnZlciB3YWtpbmcgdXAuLi4iKQogICAgICAgIGVsc2UKICAgICAgICAgICAgd2FybigiU29uaXggUHJlY2lzaW9uOiBDb25uZWN0aW9uIEludGVycnVwdGVkLiBDb2RlOiAiIC4uIChyZXNwb25zZSBhbmQgdG9zdHJpbmcocmVzcG9uc2UuU3RhdHVzQ29kZSkgb3IgIlRpbWVvdXQiKSkKICAgICAgICBlbmQKICAgICAgICB0YXNrLndhaXQoMykgLS0gUG9sbCBldmVyeSAzIHNlY29uZHMgdG8gc3RheSB1bmRlciBSZW5kZXIgcmF0ZSBsaW1pdHMKICAgIGVuZAplbmQp";

app.get('/', (req, res) => {
    res.set('Content-Type', 'text/plain');
    // We send the Base64 string directly
    res.send(S);
});

// Route to handle chat messages (this stays the same)
app.get('/get_messages', (req, res) => {
    // ... your message logic here ...
});

app.listen(PORT, () => console.log('Sonix Final: Ready'));
